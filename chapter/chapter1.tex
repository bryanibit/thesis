\chapter{绪论}
\section{研究背景与意义}
智能移动机器人可以独立或辅助人类完成很多任务，这依赖其对环境的感知、导航和运动规划等过程。无人驾驶车辆作为一种智能移动机器人，未来将在解决城市交通拥堵，灾区救援等方面发挥重要作用。无人驾驶车辆在未知区域导航时，对感知、规划等的要求很高，所以一般的无人驾驶车辆都依赖详细的地图进行导航规划\cite{Mattyus-Enhancing-road-maps}，完成既定任务。虽然卫星图像易于获取，但由于无人驾驶车辆导航精度要求高而不被采用，这是因为卫星图像存在更新不及时，精度难以满足车道线级别要求等问题。目前无人驾驶领域构建高精度地图的方法较多，一般采用车载或机载传感器等设备，总体上可以分为基于摄像头和基于激光雷达两种方案。

近年来实时定位与地图构建（SLAM, Simultaneous Localization and Mapping）作为移动机器人构建地图的方法获得长足发展，较为著名的有ORB-SLAM\cite{Mur-Artal-ORB-SLAM}，LSD-SLAM\cite{Engel-LSD-SLAM}，LOAM\cite{Zhang-LOAM}等，图~\ref{compare}是运用车载传感器得到的三维地图，其中左图使用的传感器是激光雷达，右图使用的传感器是单目摄像头。这种采用车载传感器的构图方法已经发展地较为成熟，但是运用车载传感器得到大范围地图仍有困难，这是由于车载传感器视野受限、易受遮挡，当灾区发生道路阻塞时，车辆由于无法通行而无法采集道路信息，而且使用车辆对所有道路遍历的方法效率低下。然而无人机飞行灵活，视野宽阔，可以高效地对地面拍摄并通过算法建立地理空间地图，为无人地面车辆行驶提供先验信息。

\begin{figure*}[!htbp]
	\centering
\subfigure{
	\includegraphics[width=2.5in]{chapter1/laser.png}}
\subfigure{
    \includegraphics[width=2.5in]{chapter1/camera.PNG}}
	\caption{高精度地图}
	\label{compare}
\end{figure*}

与视觉SLAM类似，SfM（Structure from Motion）也是一种构建三维场景的技术，SfM能通过2D图像得到场景3D 结构，然而SfM更多使用无序图片，运行过程不受时间限制，从而构建比SLAM更精确的3D地图。与传统的航空激光扫描（ALS, Airborne Laser Scanning）和LiDAR（Light Detection And Ranging）绘制地图相比，SfM可以得到更高分辨率的包含空间纹理的3D模型，更重要的是，SfM得到如此丰富的数据结果使用的设备更廉价。这是由于SfM使用算法匹配图像特征点，计算相机位姿，从而重建拍摄场景的“稀疏”3D点云，而后通过MVS（Multi-View Stereo）将点云稠密化，并渲染得到逼真的三维地理空间模型\cite{Carrivick-Structure-from-Motion}，基于此SfM作为一种地形测绘技术被广泛应用于地理科学中。通过学术文献数据库Web of Knowledge，我们可以查看SfM学术研究情况，从1995年至2015年共有1000条关于Structure from Motion主题的记录。其中属于计算机科学范畴的最多，而属于地理科学范畴的记录数量排在第9名\cite{Carrivick-Structure-from-Motion}，且近年来地理科学领域的SfM研究主题增长迅速，详细数据如图~\ref{count-year} 所示。

\begin{figure}[!htbp]
	\centering
	\includegraphics[width=4.5in]{chapter1/count-year.png}
	\caption{SfM主题统计曲线图}
	\label{count-year}
\end{figure}

在无人地面车辆自主导航中，地图中的道路信息显得尤为重要，道路信息决定了无人车辆使用的规划模型和决策方案等，但是SfM构建的三维地图无法直接用于无人驾驶导航规划。所以需要提取地图中的可通行区域，也就是道路区域，为无人地面车辆导航提供先验信息。近年来道路提取跟踪在无人车导航、地形分类等领域广泛应用，这些算法针对无人车视角的图像取得良好的效果，然而对于俯视视角的地图这些算法基本失效。这是因为无人车辆的相机视野方向水平，其视野中道路一般收敛为消失点，针对消失点的提取道路的方法无法应用于大范围航拍地图。对于航拍地图中提取道路，需要分析道路区域的特征：

(1) 光谱特征：道路区域的光谱与大部分的非道路区域有着明显的不同，具体表现在道路区域的RGB通道值在三维空间的分布差异。

(2)	几何特征：道路区域通常是狭长的区域，道路宽度变化不会特别明显，而且道路的曲率也不会超过一定的限度。

(3)	辐射特征：对于单一的道路区域或者非道路区域，其颜色比较均匀，灰度值的方差较小；如果同时包含道路和非道路区域，则因为其光谱特征差异明显，灰度值的方差较大。

(4)	拓扑特征：一幅卫星影像图中的道路区域会呈现出一定的拓扑结构，并且会交叉形成结构化的道路网络，具有一定的拓扑特征。

目前，结构化道路网络的提取过程主要包括图像预处理、道路边缘提取、道路二值化、道路骨架提取等步骤。道路提取总体方案主要采用全自动或者半自动的方法，全自动方法不需要人工干预、速度较快，但是由于地图道路区域较为复杂，因此提取的效果欠佳；半自动的结构化道路提取\cite{Jianhua-Automated}将自动提取过程与人工干预相结合，在道路提取的初始时刻人工选取道路区域的初始点或者初始区域并进行迭代，或者加入人机交互，对通过自动的道路提取方法提取得到的道路网路进行后续的处理，完善自动提取得到的道路骨架，但人机交互也降低了道路提取的效率。

采用SfM构建三维地理空间地图，为无人车未知区域导航提供先验信息，利用道路区域的特征，提取道路区域，通过提取的道路区域构建无人驾驶的拓扑网络，为无人驾驶路径规划导航服务。

\section{国内外研究现状}
\subsection{地图构建方法研究}
%国内国外 算法少 slam 飞机 车
构建适用于无人车辆行驶的地图是无人驾驶领域的关键技术之一，是进行路径规划与自主决策的重要信息源。许谦\cite{xuqian-wuren}利用3D激光雷达和摄像头获取无人车环境信息，将得到的环境感知质点模型与环境感知区域添加到GIS（Geographic Information System）数据库中，实现基于GIS的地图动态更新的过程。宋晓虎\cite{songxiaohu-OSM}构建基于OpenStreetMap（OSM）的电子导航地图，将SRTM（Shuttle Radar Topography Mission）高程数据巧妙添加到原始OSM地图信息中，合并多层平面金字塔图与多级精度高程图获得立体地图。百度公司的地图车使用高精度定位系统与高精度3D 激光雷达绘制三维场景%地图车绘制高精度地图，为无人车自动自主驾驶服务，其使用高精度定位系统，结合高精度3D 激光雷达绘制三维场景，
并使用算法从激光点云中提取车道线，使高精度地图达到车道级别的精度，这种方法也被广大无人驾驶厂商采用，但是地图车价格昂贵，同时该方法不适合野外等条件的地图采集。

近年使用SLAM技术进行实时地图构建的方法被越来越多的无人驾驶研究机构采纳，李玉\cite{liyu-jiguagn} 使用车载3D激光雷达获得稠密点云信息，采用迭代最近点（Iterative Closest Points, ICP）算法求取相邻帧3D点云的旋转平移关系，并评估得到的拼接点云中每个粒子的优劣，选择最优粒子加入全局地图，通过匹配拼接激光雷达数据获得地理空间的三维结构。段华旭\cite{duanfeixu-wuren}采用双目视觉基于ORB特征提取和BoW（Bag of Words）模型闭环检测的方法，对地理空间进行三维重建，后端通过高斯-牛顿迭代法最小化三维场景的重投影误差，在优化重投影误差过程中考虑误差函数雅各比矩阵的稀疏性，从而加快整个优化过程。张毅\cite{zhangyi-wuren}围绕环境构图相关问题，提出了环境建图中基于粗集理论的数据融合算法，探索了构图过程中二维地图全新表示方法。邹智荣\cite{zhirong-dongtai}提出动态环境下自主车SLAM技术，针对大部分SLAM构图是基于静态环境完成的，本文提出了使用数据关联技术消除动态障碍干扰的方法，区分静动态障碍，并通过实验验证动态SLAM的有效性。

由于无人机的视角原因，无人机的地图构建更加灵活高效，谢斌\cite{xiebin-weizhihuanjing}提出使用无人机通过D-S证据理论在未知环境构建适航地图的方法，该方法有效提高无人机对地面目标跟踪的准确性。刘洋\cite{liuyang-sanwei}为解决无人机路径规划问题，提出改进的概率地图模型，使用蚁群算法增加概率地图窄通道的采样点数量，获得可以覆盖规划环境的概率决策地图。陈含欣\cite{chenhanxin-wuren}采用自适应重采样FastSLAM算法，利用无人机进行视觉定位与3D构图。蒙山\cite{mengshan-danmu}提出一种基于几何特征的视觉三维重建SfM方法，使用单目相机基于二维直线匹配生成三维空间直线，并通过点线特征结合及直线增强算法减少三维空间表达的冗余信息。马跃龙\cite{mayuelong-danmu}借助SLAM技术得到无人机航拍视频关键帧间的相机关系，据此得到关键帧间的单应性关系，最后得到二维图像的拼接结果形成正摄投影地图。杨详红\cite{yangxianghong-wurenji}针对传统被动SLAM构图低效性，在SLAM中加入规划的思想，使构图更加高效。

在移动机器人地图构建领域，国外的研究起步较早，Leonard\cite{Leonard-concurrent}提出使用移动机器人的机载传感器实现同时定位与构图的过程，虽然使用的传感器是水下声呐，但与当前视觉、激光SLAM算法相似。Typiak采用SICK等多传感器进行信息融合构建地图，提高无人车远程控制的性能。Cole\cite{Cole-laser}使用3D激光雷达采集数据，使用简单的分割算法将点云分类并将点云转换到车体坐标系下，提出了一种新的点云配准算法，可以更鲁棒地将点云拼接为三维地图。Diosi\cite{Diosi-Interactive}使用激光雷达和声呐为移动机器人构图导航，使用问答式的人机交互为地图添加语义特征，同时使用Kalman滤波器融合雷达与声呐信息，创建带有语义特征的地图为机器人导航。近来随着计算机性能的提升，基于视觉的三维重建技术得到很大发展，使用网络上大量图片构建三维场景成为可能。Snavely\cite{Snavely-Photo}设计了交互式可浏览查看图片的3D 重建系统，拥有良好的用户体验，系统解决了网络图片涉及的相机模型、水印、清晰度、光线等因素多样性带来的问题，完成场景建模得到稀疏点云图。著名的“一日重建罗马”\cite{Snavely-Building}就是通过网络上不同类型的图片重建罗马的各个景观，使用并行计算的方法提高运行效率，一天内可处理超过15万张照片，图~\ref{buildRome}展示重建得到罗马三维结构。

\begin{figure*}[!htbp]
	\centering
    \subfigure{
	\includegraphics[width=2.5in]{chapter1/rome/rome_paper-09.png}}
    \subfigure{
	\includegraphics[width=2.5in]{chapter1/rome/rome_paper-10.png}}
    \subfigure{
	\includegraphics[width=2.5in]{chapter1/rome/rome_paper-23.png}}
    \subfigure{
	\includegraphics[width=2.5in]{chapter1/rome/rome_paper-24.png}}
	\caption{一日重建罗马}
	\label{buildRome}
\end{figure*}

针对SfM耗时、效率低的缺点，Wu Changchang\cite{wuchangchang-linear-time}提出线性时间的增量式SfM算法，针对增量式SfM时间复杂度较高的缺点，提出了一种新的光束平差（Bundle Adjustment, BA）优化方法，使时间复杂度降为原来的$\frac{1}{4}$，同时兼顾构图准确性。同时Wu Changchang\cite{wuchangchagn-multicore}为加速SfM算法使用GPU优化光束平差过程，通过PCG（Preconditioned Conjugate gradients）改进非线性最小二乘求解过程，最大化利用CPU进行并行计算等。

从以上研究现状可以看出构建地图的方法多种多样，没有统一的标准格式，甚至为满足特定需要而构建的地图在其他机器人上无法使用，但是总体而言可以分为两类，一种是使用激光雷达，一种是使用双目视觉或单目视觉构建场景地图。3D激光雷达具有测距准确、精度高等特点，同时对点云分类算法的改进使实时构图三维语义地图称为可能，但是激光雷达价格昂贵，制约了其大范围商业化应用。使用视觉传感器，无论双目单目甚至三目基本原理相似，可以用于实时导航构图，但要获得稠密而精确的点云，类似图~\ref{buildRome}一般需要离线处理，因为其中涉及到匹配优化问题很难在现有计算条件下完成。

\subsection{道路提取方法研究}
%国内 国外 遥感与航空
道路作为移动机器人导航规划的重要依据，无论事先提取道路添加到地图中作为机器人规划的先验信息，还是实时提取道路区域引导移动机器人导航，道路提取都是至关重要的。在这方面的研究很多，由于遥感图像视野开阔，包含信息丰富，使用遥感影像提取道路的研究很多，Wang Xia\cite{Xia-Road}采用K-Means聚类方法对卫星图像进行分类，得到关于道路区域的二值图像；之后通过基于拓扑细化的形态学方法，对二值化图像进行处理，得到了道路骨架。汪夕明\cite{wang-yaogan}采用模糊C均值（Fuzzy C-Means, FCM）聚类的方法对卫星影像图二值化，对于图像中的交通流干扰，采用形态学重构和Mean-Shift方法加以去除，对于阴影部分采用HSV变换加以去除，实现了对有干扰图像的道路提取。魏宇峰\cite{wei-gaofen}应用SVM（Support Vector Machine）算法对遥感图像进行分类，并提出一种改进的小波变换算法提取道路，并与K-means算法对比证明其算法的有效性。
随着小型航拍无人机的普及，针对无人机的道路提取方法变多。Yucong Lin\cite{Lin-Road-detection}提出了一种从无人机航拍图像中快速而鲁棒地提取道路的方法，作者使用梯度直方图检测道路区域，进而使用概率Hough变换和聚类算法提取更精细的道路区域，实验表明该方法可以提取野外沙漠环境中97\%的道路区域。Wegner\cite{Wegner-Higher-Order} 提出一种新的高阶条件随机场模型用来提取航空图像中的道路，首先提取超像素构成的道路区域，而后使用CRF(Conditioned Random Field)优化图割结果，实验证明该方法可以更好地保留道路的拓扑结构，更好地区分道路与非道路像素。Shenlong Wang\cite{Mattyus-Fine-Grained}针对半自动地图构建以及未来无人车更加依赖地图信息的趋势，提出以OpenStreetMap(OSM)数据为输入，采用深度学习方法，检测并标记地图中车道、人行路、停车位等各种信息，精炼地图；针对航空图像与车载传感器输出图像的特点，融合二者提取的道路区域，相对于GPS+IMU系统，这种融合道路区域的方法有更好的精度。Shenlong Wang\cite{Mattyus-Enhancing-road-maps}提出使用航空图像道路网络改进更新开源地图的方法，采用马尔科夫随机场模型对道路中线与道路宽度建模，对OSM中的图片进行道路提取，据此可以纠正OSM道路图层的错误；作者也通过结构SVM方法训练OSM数据集，得到人行道、绿化区域的模型用于提取测试集的道路相关区域。图~\ref{enhancing}展示了从OSM中提取道路的结果。

\begin{figure*}[!htbp]
	\centering
    \subfigure{
	\includegraphics[width=2.7in]{chapter1/road/EnhancingRoadMaps-9.jpg}}
    \subfigure{
	\includegraphics[width=2.7in]{chapter1/road/EnhancingRoadMaps-1.jpg}}
	\caption{基于OSM的道路提取结果}
	\label{enhancing}
\end{figure*}

遥感图像提供了对地理空间更全的覆盖区域，但是由于分辨率较低，提取道路难度较大；随着航空飞行器的普及，使用小型低空飞行器获取地面影像，并从中提取道路区域更加灵活方便。从以上研究现状分析，道路提取的方法虽各不相同，但是都利用道路特点――光谱特征、几何特征等。首先提取初始道路区域，而后根据道路细长的特点得到道路区域；也有使用部分道路作为训练集，利用深度学习的方法让机器自己学习道路特征，而后使用该模型提取道路区域。尽管经过多年的研究，道路检测的方法很多，但是提取道路仍然不是件容易的事，大范围自动提取道路仍然是一个有待解决的问题。\cite{Mattyus-Enhancing-road-maps}

\section{主要研究内容}
三维重建技术由来已久，尤其广泛应用于无人驾驶车辆导航、定位与决策中。然而无人驾驶车辆直接使用三维地图存在困难，因为无人驾驶车辆很难在三维地图中分辨可通行区域以及障碍物等信息。而道路作为引导无人驾驶车辆导航的重要信息，从地图中提取道路变得愈发重要。基于这样的背景，本课题的研究内容主要包括以下几点：

$\bullet$ 融合高精度定位信息与视觉传感器信息，构建适用于无人车的二维道路地图，为无人车执行全局路径规划提供先验信息。

$\bullet$ 使用无人机三维重建技术，离线构建高精度三维地理空间地图，为未知环境的无人车导航提供地图信息。

$\bullet$ 提取二维地图中的道路区域，构建道路拓扑网络，依托GIS软件为无人车导航规划提供依据。

\subsection{二维与三维地图构建}
%二维三维地图的应用方式 三维重要性要多写 不能说现在没用，你没做不代表这没有用，三维能提供更多信息
\subsubsection{传感器选取}
在开始研究之前，本文先讨论研究所涉及到的传感器选型问题。如图~\ref{sensors}所示是通常使用的视觉传感器、3D激光雷达，图$(a)$是双目相机，双目相机可以通过左右摄像头计算得到场景深度图，但双目相机的基线较短，当物体距相机较远时，计算得到的物体深度图误差较大。图$(b)$是全景相机，可以获取周围$360^\text{o}$ 场景，视野开阔，但相机模型较复杂。图$(c)$激光雷达可以直接得到3D点云，且精度高，但激光雷达价格昂贵限制了其广泛应用。图$(d)$ 是最常见的单目相机，相机的成像可以近似抽象为小孔成像模型，处理其成像较全景相机更方便，无法直接得到景深图，但单目相机尺度未知问题可以通过算法解决。
\begin{figure}[!htbp]
	\centering
	\includegraphics[width=4.7in]{chapter1/sensors.png}
	\caption{传感器示例}
	\label{sensors}
\end{figure}

针对以上分析，结合本文的实际使用需要，本文设计的构建二维地图方法旨在为无人车导航提供先验信息，无人车通过定位信息匹配到二维地图的某区域后，无人车即可通过地图知道当前的车道、限速、甚至距离路口远近以及是否有红绿灯等信息，这些先验信息将为无人车导航规划提供巨大帮助。三维数据存储、运算等耗费资源，所以在二维地图构建中倾向于选择视野开阔的全景相机。

三维地图虽然构建复杂、存储空间较大，但是三维地图可以提供更多的地理空间信息，随着计算机硬件与算法的发展，3D地图必将是未来无人车地图发展的方向。由于本文要使用无人机视觉的方案构建三维场景地图，在传感器的选取上只能选择单目相机，因为无人机飞行高度较高，此时双目相机的基线基本上可以忽略，两个双目相机的输出基本相同，无法解算得到景深图。
\subsubsection{二维地图构建}
二维图像由于操作简单，存储方便等原因被许多无人车采用，本文为了获取视野更大的二维图像选取全景相机，将全景相机架设在无人车辆顶部，可以得到无人车周围环境的全景图。全景相机成像在球面坐标系中，其中车道线扭曲严重，所以本文将全景图投影到地面坐标系中，使车道线之间保持平行，得到类似俯视视角的由全景视频变换后的视频流。通过高精度定位系统，将每帧视频流对应的车辆定位坐标信息编码为二维码放置于每帧视频的右下角，如此设计一套采集地图系统。解算采集的视频流中每帧视频对应的二维码信息为位置、航向，而后根据位置航向将图片旋转平移后拼接成完整的路网地图。

以拼接的路网地图为底图，通过自动或半自动的方式构建道路的拓扑网络，拓扑网络由点、线以及道路属性（车道数量、限速、是否路口等信息）构成，为无人车导航决策提供依据。

\subsubsection{三维地图构建}
不同于二维地图，三维地图由于包含的信息丰富，在仿真与实车实验中应用广泛，本文构建三维地图的方法是使用无人机搭载的单目摄像机拍摄地理空间的二维图片，将一系列无序的二维图片作为输入，重建地理空间三维场景。首先对所有图片提取其特征点，将二维图片矩阵转换为一维特征点向量，而后匹配特征点，将无序图片通过匹配点联系起来，使用多视图几何相关知识恢复匹配点的三维坐标和相机位姿，最后采用光束平差法优化稀疏点云与相机位姿。采用Multi-View Stereo(MVS)算法计算每幅图片的深度图，融合深度图得到完整的稠密点云。
\subsection{二维图像中的道路提取}
道路检测对无人驾驶至关重要，本文采用最小二乘法拟合测试集道路区域的光谱特征，从而得到初始的道路区域，用二值化的图片表示，但是二值图存在非道路区域的错误检测，本文采用开闭运算平滑二值图，并采用矩形检测等方法移除开闭运算无法消除的大面积的非道路区域，至此可以得到较为理想的道路二值图。在此基础上，通过拓扑细化及短枝丫剔除的方法得到单像素构成的道路拓扑图片，使用GIS软件可以直接生成拓扑路网，用于无人车导航规划。
\section{本章小结}
本章概述了课题研究背景与意义，针对无人驾驶导航与规划高度依赖地图的现象，构建适合无人驾驶的地图变得十分关键。针对这一问题，本文通过查阅当前地图构建的研究现状，设计了新的适合无人驾驶使用的二维地图与三维地图构建方法。同时由于道路信息在无人驾驶导航规划中有着重要意义，提出从二维地图中提取道路网络，构建道路拓扑，为无人车全局路径规划提供先验信息。本文研究总体内容可以用流程图~\ref{flow-whole-all}表示。

\begin{figure}[H]
\centering
\includegraphics[width=5.0in]{chapter1/flow-whole.png}
\caption{本文研究内容}
\label{flow-whole-all}
\end{figure}
