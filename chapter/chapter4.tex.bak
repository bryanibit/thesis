\chapter{二维图像中的道路提取}

\section{引言}
最近数十年来许多方法被应用于无人地面车辆自主导航，使用地图提高定位、场景理解的方法是非常成功的。大部分无人车依靠详细路网地图导航，然后这些路网地图基本是靠手工完成的，如此限制了当前无人车辆的大范围普及。提取道路的方法被广泛的研究用于车辆导航与区域分割，这些算法对于UGV有很好的效果，然而对于UAV这些算法基本都失效。这是因为UGV的相机朝前安装而UAV相机俯视地面，UGV视野中道路在视野尽头一般收敛为消失点，针对消失点的提取道路的方法在UAV上效果较差，为了解决这一问题本文提出了使用图像二值化并结合道路拓扑关系相关内容对航拍图像进行道路提取。
\section{图像二值化}
本文采用最小二乘法提取道路区域得到二值化的图像。在实际工程中我们总是希望找到数据的线性关系，不幸的是对于实际数据找到这样完美的线性关系并不容易，然而最小二长发提供了一种可信赖的最小化残差方法，这展示了观测与拟合之间的差别。考虑到某区域的道路颜色特征基本一致的特点，本文采用线性最小二乘的方法拟合图像道路区域的RGB颜色特征，得到道路的二值化图。

首先从UAV图片中找到一部分道路区域作为训练的样本集，如图~\ref{trainimage}中非黑色部分，再次训练集中的图片分为RGB三个通道展示在三维空间坐标系中，如图~\ref{regression}中蓝色点所示，而后最小二乘法被用于拟合这些观测值（蓝色点）为一条直线$frac{x+x_1}{a}=frac{y+y_1}{b}=frac{z}{1}$，如图~\ref{regression}中红色直线所示，最后可以计算所有观测点与拟合直线之间的平均欧式距离$D$。对于需要处理的图片，也就是测试集数据，遍历图片的每个像素，如果测试集像素与拟合直线的欧氏距离大于$3D$则将该像素赋值为零，否则赋值为一，进而得到和原图大小相同的二值图，按照这种方法进而每张UAV图片转化为二值图。
\begin{figure}[!htbp]
\centering
\includegraphics[width=5.4in]{chapter4/trainimage.png}
\caption{训练集}
\label{trainimage}
\end{figure}
\begin{figure}[!htbp]
\centering
\includegraphics[width=5.4in]{chapter4/regression.png}
\caption{线性回归}
\label{regression}
\end{figure}

\section{非道路区域移除}
通过最小二乘法我们初始的道路区域，然而这有很多的噪声和错误的道路检测，为了减少噪声和误差，本文采用数学形态学精间结果。数学形态学是关于基于拓扑的图像分析学科，基本的操作有开闭运算、俯视膨胀运算和形态学梯度等。道路有显而易见的不同于图片周围物体的形态学特征――瘦长。这些拓扑特征可以被用来消除二值图中的非道路区域，精简二值图。
\subsection{开闭运算}
在最小二乘法得到的二值图中存在许多噪声，例如小孔等，这影响了道路的完整性，本文中，开闭运算被用来移除孔洞，消除噪声，平滑道路区域。开运算是先腐蚀图片后膨胀图片的运算，而闭运算正好相反，是先膨胀后腐蚀图片，式~\ref{open-equation}和~\ref{close-equation}所示。其中二值图像的腐蚀是指选择大小一定的核函数$K$，$K$一般是方阵，则二值图像$I$被$K$腐蚀可以理解为$K$在$I$内部移动时，$K$ 的中心经过的区域即为腐蚀后的$I$的值。二值图像的膨胀是指选择大小一定的核函数$K$，$K$一般为方阵，则二值图像$I$被$K$膨胀可以理解为$K$的中心在$I$内部移动时，$K$所经过的区域。腐蚀膨胀的示意图如~\ref{erosionDilation}中左图深蓝色为腐蚀掉的像素，右图浅蓝色为膨胀后的像素。
\begin{equation}
Open(I,K)=dilate(erode(I,k),K)
\label{open-equation}
\end{equation}
\begin{equation}
Close(I,K)=erode(dilate(I,k),K)
\label{open-equation}
\end{equation}

\begin{figure}[!htbp]
\centering
\includegraphics[width=5.4in]{chapter4/erosionDilation.png}
\caption{腐蚀膨胀示意图}
\label{erosionDilation}
\end{figure}
基于开闭运算的方法，道路区域被平滑，大量干扰（噪声）被移除，但是仍然存在非道路区域，像房子边缘，被错误识别为道路，由于这些区域面积较大，所以基于开闭运算的方法无法移除这些区域，所以采用以下方法去除非道路道路的干扰。

\subsection{轮廓提取}
Ramer Douglas Peucker算法（简称RDP）是由Ramer、David Douglas和Thomas Peucker提出的\cite{Heckbert-polygonal}，通过物体轮廓估计物体形状。需要移除的房子边缘被检测为满足式~\ref{houseedge1-equation}、~\ref{houseedge2-equation}与~\ref{houseedge3-equation}的轮廓，而这些被需要移除。
\begin{equation}
  \label{houseedge1-equation}
  \|C-C^{\prime}\|\leq 10\% C
\end{equation}
\begin{equation}
  \label{houseedge2-equation}
  60^{\circ} \leq \theta \leq 100^{\circ}
\end{equation}
\begin{equation}
  \label{houseedge3-equation}
  \frac{L}{L^{\prime}}\leq 6 \quad or\quad \frac{L}{L^{\prime}}\geq \frac{1}{6}
\end{equation}
其中，$C$ 、 $C^{\prime}$代表原始轮廓与近似轮廓的周长，$\theta$代表$C^{\prime}$中每两个相邻顶点连线所成的角度。$L$和$L^{\prime}$代表$C^{\prime}$的相邻两边。按照该式可以检测到几个两个非道路区域，如~\ref{rectangles}中红色矩形所示。
\begin{figure}[!htbp]
	\centering
	\includegraphics[width=5.2in]{chapter4/rectangle_fix.jpg}
	\caption{轮廓检测}
	\label{rectangles} %% label for first subfigure
\end{figure}
至此，我们完成了形态学滤波得到较为理想的道路区域，然而这样的道路并不适合直接应用于无人车路径规划与导航，因为UGV路径规划需要拓扑路网，下面将介绍如何从栅格道路提取道路骨架，得到拓扑路网的过程。

\section{拓扑处理}
\subsection{拓扑细化}
栅格地图可以被简化为无人车路径规划中广泛使用的拓扑地图，这种地图有基本几何元素组成，例如节点和弧线、直线等。Choi\cite{Choi-Topological}使用拓扑细化的方法提取道路骨架，道路的宽度不会影响算法的有效性，图~\ref{too}显示了拓扑细化算法的过程，图中左边类似形态学处理后的道路区域，右边类似拓扑处理后的道路骨架，可以看出线段宽度不影响最后得到的道路骨架结果。
\begin{figure}[!htbp]
	\centering
	\includegraphics[width=5.0in]{chapter4/TopoloThin.png}
	\caption{拓扑细化}
	\label{topo}
\end{figure}
拓扑细化的目的就是剥离像素，知道无法剥离为止，从而得到单像素构成的拓扑骨架。对于构成道路的像素是否可以剥离取决于像素的连通数，连通数的概念由式~\ref{connectivitynum-equation}和图~\ref{fig:topoN}定义。
\begin{equation}
\label{connectivitynum-equation}
C=\sum(N_{k}-N_{k}N_{k+1}N_{k+2}),k=1,3,5,7,N_{9}=N_{1}
\end{equation}

\begin{figure}[!htbp]
	\centering
	\subfigure[8-region connectivity]{
		\label{fig:subfig:topo1} %% label for first subfigure
		\includegraphics[width=1.8in]{chapter4/topoN.png}}
	\subfigure[Connectivity Example]{
		\label{fig:subfig:topo2} %% label for first subfigure
		\includegraphics[width=1.8in]{chapter4/topocir.png}}
	\subfigure[Branch Example]{
		\label{fig:pixelExample} %% label for first subfigure
		\includegraphics[width=1.9in]{chapter4/node.png}}
	\caption{Connectivity}
	\label{fig:topoN}
\end{figure}
%$N_k$是目标像素8个邻域中的一个邻域的像素值，对于二值化图像，像素值非0即1，图~\ref{fig:subfig:topo1}表示了8邻域$N_k$的基本含义，$N_i$代表像素值，二值图像中该值非零即一，图~\ref{fig:subfig:topo2}中黑色圆形对应的像素值为1，白色为0，
在~\ref{fig:subfig:topo1}中$N_i$表示像素值，例如$N_1=1,N_2=0$，二值图像中像素值非0即1，

\subsection{去除小枝丫}

\section{本章小结}
